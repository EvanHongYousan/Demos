<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="css/main.css"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
</head>
<body>
<div class="none"></div>
<div class="container index">
    <img class="top" src="images/bg1_top.jpg" alt=""/>

    <div class="middle">
        <img src="images/bg1_middle.jpg" alt=""/>

        <div>
            <input type="text" id="phoneNum" value="" placeholder="输入手机号码"/>
            <span id="submit">马上抢</span>
        </div>
    </div>

    <div class="bottom">
        <img src="images/bg1_bottom.jpg" alt=""/>

        <h3><span>----------</span>&nbsp;活动规则&nbsp;<span>----------</span></h3>
        <ul>
            <li>1.输入手机号抢红包。手气越好金额越高</li>
            <li>2.下载呼叫老师,用该手机号登陆,就可以用红包换学时啦~</li>
            <li>3.每人只能抢一次,多抢木有~</li>
            <li>4.本次活动限学生参与,老师抢不了哦~</li>
            <li>5.呼叫老师团队对本次活动保留最终解释权。</li>
        </ul>
        <p class="href"><a href="http://www.hjlaoshi.com">www.hjlaoshi.com</a></p>
    </div>
</div>
<div class="container result opacity0">
    <img src="images/bg3_up.jpg" alt="" class="top"/>

    <div class="bottom">
        <div class="voucher">
            <span><small>￥</small><span>500</span></span>
        </div>
        <img src="images/tickets.png" alt="" class="tickets"/>
        <img src="images/bg2_down.jpg" alt=""/>

        <div class="text">
            <p class="whiteText">你已经抢过红包啦~<br/>快去问作业吧</p>

            <p>现金券已放入手机账户</p>

            <p class="phoneNumber">快去问作业吧</p>
            <span id="downloadBtn">下载呼叫老师APP</span>

            <p style="font-size: 20px;">马上问作业</p>
        </div>

        <p class="href"><a href="http://www.hjlaoshi.com">www.hjlaoshi.com</a></p>
    </div>
</div>
<div class="mask">
    <div class="tip">
        <div class="tip-content">请输入正确的手机号码</div>
        <div class="tip-footer">确定</div>
    </div>
</div>
<script src="../common/spread.js"></script>
<script src="http://apps.bdimg.com/libs/zepto/1.1.4/zepto.min.js"></script>
<script>
    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };
</script>
<script>
    (function () {
        function switchPage(phoneNum, money) {
            $('.result .text p.phoneNumber').text(phoneNum);
            $('.result .voucher span > span').text(money);
            $('.result > img').eq(0).attr('src', 'images/bg2_up' + parseInt(Math.random() * 4 + 1) + '.jpg');

        }

        function getReqPrm(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            } else {
                return null;
            }
        }

        function isIOS() {
            var userAgent = window.navigator.userAgent.toLowerCase();
            if (userAgent.indexOf('android') > 0) return 1;     //android
            if (/iphone/i.test(userAgent) || /ipod/i.test(userAgent) || /ipad/i.test(userAgent)) return 2;      //IOS
            return 'anyotherelse';
        }

        function getData(phoneNum) {
            $.getJSON(
                            spreadData.jsonPURL + "?id=" + spreadData.id + "&phone=" + phoneNum + '&client=' + isIOS() + '&callback=?',
                    function (data) {
                        console.log(data);
                        if (data.status == '7') {
                            $('.index').hide();
                            $('.result').removeClass('none').removeClass('opacity0');
                            $('.result .voucher').remove();
                            $('.result > img').eq(0).attr('src', 'images/bg3_up.jpg');
                            $('.opacity0').removeClass('opacity0');
                            $('.loader').remove();
                            $('.result .text p.phoneNumber').text(getReqPrm('phoneNum'));
                            $('.result .text > .whiteText').show();
                        }
                        else if (data.status == '1') {
                            $('.index').hide();
                            $('.result').removeClass('none').removeClass('opacity0');
                            $('.opacity0').removeClass('opacity0');
                            $('.loader').remove();
                            switchPage(getReqPrm('phoneNum'), data.price);
                        }
                        else {
                            $('.mask .tip-content').text(data.msg);
                            $('.mask').show();
                        }
                    }
            );
        }

        $('#submit').click(function () {
            if (/^1[345678]\d{9}$/.test($('#phoneNum').val())) {
//                window.location = './result.html?phoneNum=' + $('#phoneNum').val();
                getData($('#phoneNum').val());
            } else {
                $('#phoneNum').attr('placeholder', '请输入正确的手机号码');
//                $('#phoneNum').val('');
                $('.mask').show();
            }
        });
        $('#downloadBtn').click(function () {
            location.href = 'http://www.hjlaoshi.com'
        });
        $('.mask .tip-footer').click(function () {
            $('.mask').hide();
        });
        $('.mask').on('touchmove', function () {
            return false;
        });
        setTimeout(function () {
            setTimeout(function () {
                $('.mask').height(document.body.clientHeight);
                $('.result').addClass('none');
            }, 1000);
            if ((new Date()).Format("yyyy-MM-dd hh:mm:ss") > spreadData.endTime || (new Date()).Format("yyyy-MM-dd hh:mm:ss") < spreadData.beginTime) {
                $('.tip .tip-content').html('好可惜，来晚啦~~红包已经抢完啦~下载呼叫老师期待下次优惠活动吧~~');
                $('.mask .tip-footer').click(function () {
                    document.location.href = "http://www.hjlaoshi.com"
                });
                $('.mask').show();
            }
        }, 500);
        $('title').text(spreadData.name[Math.floor(Math.random() * 3)]);
        $('.none').text(spreadData.shareWording[Math.floor(Math.random() * 3)]);
    })();
</script>
</body>
</html>